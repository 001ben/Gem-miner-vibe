#!/bin/bash
set -e

echo "üîß Initializing Jules Environment..."

# 1. Install Task (go-task)
if ! command -v task &> /dev/null; then
    echo "Installing Task..."
    sudo sh -c "$(curl --location https://taskfile.dev/install.sh)" -- -d -b /usr/local/bin
else
    echo "Task is already installed."
fi

# 2. Install UV (Package Manager)
if ! command -v uv &> /dev/null; then
    echo "Installing UV..."
    curl -LsSf https://astral.sh/uv/install.sh | sh
    # Ensure uv is in path for this session
    export PATH="$HOME/.cargo/bin:$PATH"
else
    echo "UV is already installed."
fi

# 3. Verify Blender (Optional - just check)
if ! command -v blender &> /dev/null; then
    echo "‚ö†Ô∏è  Blender not found. 'task build:assets' may fail if it requires local Blender."
    echo "Attempting to install Blender via apt..."
    sudo apt-get update && sudo apt-get install -y blender || echo "‚ùå Failed to install Blender. Proceeding without it."
else
    echo "Blender is present."
fi

echo "‚úÖ Environment Initialized. Try running 'task --list'"
